{"ast":null,"code":"\"use strict\";\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar helper_1 = require(\"../actions/helper\");\n\nvar Error_1 = require(\"../actions/Error\");\n\nvar Print_1 = require(\"../actions/Print\");\n\nvar MessageTransport_1 = require(\"../MessageTransport\");\n\nvar collection_1 = require(\"../util/collection\");\n\nvar shared_1 = require(\"../util/shared\");\n\nvar env_1 = require(\"../util/env\");\n\nvar print_1 = require(\"./print\");\n\nvar redirect_1 = require(\"./redirect\");\n\nvar types_1 = require(\"./types\");\n\nvar Hooks_1 = __importDefault(require(\"./Hooks\"));\n\nexports.WINDOW_UNDEFINED_MESSAGE = 'window is not defined. Running an app outside a browser is not supported';\n\nfunction redirectHandler(hostFrame, config) {\n  var apiKey = config.apiKey,\n      shopOrigin = config.shopOrigin,\n      _a = config.forceRedirect,\n      forceRedirect = _a === void 0 ? !env_1.isDevelopmentClient : _a;\n  var location = redirect_1.getLocation();\n\n  if (env_1.isFrameless || !location || !apiKey || !shopOrigin || !forceRedirect || !redirect_1.shouldRedirect(hostFrame)) {\n    return;\n  }\n\n  var url = \"https://\" + shopOrigin + \"/admin/apps/\" + apiKey + location.pathname + (location.search || '');\n  redirect_1.redirect(url);\n}\n\nfunction appSetUp(app) {\n  app.subscribe(Print_1.ActionType.APP, print_1.handleAppPrint);\n}\n/**\n * Extracts the query parameters from the current URL.\n * @deprecated This function has been deprecated.\n * @public\n */\n\n\nfunction getUrlParams() {\n  var params = {};\n  var location = redirect_1.getLocation();\n\n  if (!location) {\n    return params;\n  }\n\n  var hashes = location.search.slice(location.search.indexOf('?') + 1).split('&');\n  return hashes.reduce(function (acc, hash) {\n    var _a;\n\n    var _b = hash.split('='),\n        key = _b[0],\n        val = _b[1];\n\n    return __assign({}, acc, (_a = {}, _a[decodeURIComponent(key)] = decodeURIComponent(val), _a));\n  }, params);\n}\n\nexports.getUrlParams = getUrlParams;\n/**\n * Extracts the `shop` query parameter from the current URL.\n * @deprecated This function has been deprecated, see {@link https://help.shopify.com/api/embedded-apps/shop-origin}\n * @public\n */\n\nfunction getShopOrigin() {\n  var params = getUrlParams();\n  return params.shop;\n}\n\nexports.getShopOrigin = getShopOrigin;\n/**\n * @internal\n */\n\nexports.createClientApp = function (transport, middlewares) {\n  if (middlewares === void 0) {\n    middlewares = [];\n  }\n\n  var getStateListeners = [];\n  var listeners = [];\n  var actionListeners = {};\n\n  var invokeCallbacks = function (type, payload) {\n    var hasCallback = false;\n\n    if (actionListeners.hasOwnProperty(type)) {\n      for (var _i = 0, _a = actionListeners[type]; _i < _a.length; _i++) {\n        var listener = _a[_i];\n        var id = listener.id,\n            callback = listener.callback;\n        var matchId = payload && payload.id === id;\n\n        if (matchId || !id) {\n          callback(payload);\n          hasCallback = true;\n        }\n      }\n    }\n\n    if (hasCallback) {\n      return;\n    } // Throw an error if there are no subscriptions to this error\n\n\n    var errorType = helper_1.findMatchInEnum(Error_1.ActionType, type);\n\n    if (errorType) {\n      Error_1.throwError(errorType, payload);\n    }\n  };\n\n  var handler = function (event) {\n    var action = event.data;\n\n    switch (action.type) {\n      case 'getState':\n        var resolvers = getStateListeners.splice(0);\n        resolvers.forEach(function (resolver) {\n          return resolver(action.payload);\n        });\n        break;\n\n      case 'dispatch':\n        var payload_1 = action.payload;\n        invokeCallbacks(payload_1.type, payload_1.payload);\n        listeners.forEach(function (listener) {\n          return listener.callback(payload_1);\n        });\n        break;\n\n      default: // Silently swallow unknown actions\n\n    }\n  };\n\n  transport.subscribe(handler);\n  return function (config) {\n    if (!config.shopOrigin) {\n      throw Error_1.fromAction('shopOrigin must be provided', Error_1.AppActionType.INVALID_CONFIG);\n    }\n\n    var protocol = /^https?:\\/\\//;\n\n    if (protocol.test(config.shopOrigin)) {\n      var message = \"shopOrigin should not include protocol, please use: \" + config.shopOrigin.replace(protocol, '');\n      throw Error_1.fromAction(message, Error_1.AppActionType.INVALID_CONFIG);\n    }\n\n    if (!config.apiKey) {\n      throw Error_1.fromAction('apiKey must be provided', Error_1.AppActionType.INVALID_CONFIG);\n    }\n\n    var dispatcher = createDispatcher(transport, config); // It is possible to initialize an app multiple times\n    // Therefore we need to clear subscriptions to be safe\n\n    dispatcher(types_1.MessageType.Unsubscribe);\n\n    function dispatch(action) {\n      dispatcher(types_1.MessageType.Dispatch, action);\n      return action;\n    }\n\n    redirectHandler(transport.hostFrame, config);\n    var hooks = new Hooks_1.default();\n    var app = {\n      localOrigin: transport.localOrigin,\n      hooks: hooks,\n      dispatch: function (action) {\n        if (!app.hooks) {\n          return dispatch(action);\n        }\n\n        return app.hooks.run(types_1.LifecycleHook.DispatchAction, dispatch, app, action);\n      },\n      featuresAvailable: function (features) {\n        return app.getState('features').then(function (state) {\n          if (features) {\n            Object.keys(state).forEach(function (feature) {\n              if (!features.includes(feature)) {\n                delete state[feature];\n              }\n            });\n          }\n\n          return state;\n        });\n      },\n      getState: function (query) {\n        return new Promise(function (resolve) {\n          getStateListeners.push(resolve);\n          dispatcher(types_1.MessageType.GetState);\n        }).then(function (state) {\n          if (query) {\n            return query.split('.').reduce(function (value, key) {\n              if (typeof state !== 'object' || Array.isArray(state)) {\n                return undefined;\n              }\n\n              value = state[key];\n              state = value;\n              return value;\n            }, undefined);\n          }\n\n          return state;\n        });\n      },\n      subscribe: function () {\n        if (arguments.length < 2) {\n          return collection_1.addAndRemoveFromCollection(listeners, {\n            callback: arguments[0]\n          });\n        }\n\n        var type = arguments[0];\n        var callback = arguments[1];\n        var id = arguments[2];\n        var actionCallback = {\n          callback: callback,\n          id: id\n        };\n        var payload = {\n          type: type,\n          id: id\n        };\n\n        if (!actionListeners.hasOwnProperty(type)) {\n          actionListeners[type] = [];\n        }\n\n        dispatcher(types_1.MessageType.Subscribe, payload);\n        return collection_1.addAndRemoveFromCollection(actionListeners[type], actionCallback, function () {\n          return dispatcher(types_1.MessageType.Unsubscribe, payload);\n        });\n      },\n      error: function (listener, id) {\n        var _this = this;\n\n        var unsubscribeCb = [];\n        helper_1.forEachInEnum(Error_1.ActionType, function (eventNameSpace) {\n          // tslint:disable-next-line:no-invalid-this\n          unsubscribeCb.push(_this.subscribe(eventNameSpace, listener, id));\n        });\n        return function () {\n          unsubscribeCb.forEach(function (unsubscribe) {\n            return unsubscribe();\n          });\n        };\n      }\n    };\n\n    for (var _i = 0, middlewares_1 = middlewares; _i < middlewares_1.length; _i++) {\n      var middleware = middlewares_1[_i];\n      middleware(hooks, app);\n    }\n\n    appSetUp(app);\n    return app;\n  };\n};\n/**\n * @public\n */\n\n\nfunction createAppWrapper(frame, localOrigin, middleware) {\n  if (middleware === void 0) {\n    middleware = [];\n  }\n\n  if (!frame) {\n    throw Error_1.fromAction(exports.WINDOW_UNDEFINED_MESSAGE, Error_1.AppActionType.WINDOW_UNDEFINED);\n  }\n\n  var location = redirect_1.getLocation();\n  var origin = localOrigin || location && location.origin;\n\n  if (!origin) {\n    throw Error_1.fromAction('local origin cannot be blank', Error_1.AppActionType.MISSING_LOCAL_ORIGIN);\n  }\n\n  var transport = MessageTransport_1.fromWindow(frame, origin);\n  var appCreator = exports.createClientApp(transport, middleware);\n  return appCreator;\n}\n\nexports.createAppWrapper = createAppWrapper;\n/**\n * Creates your application instance.\n * @param config - Both `apiKey` and `shopOrigin` are required.\n * @remarks\n * You will need to store `shopOrigin` during the authentication process and then retrieve it for the code to work properly. To learn more about this process, see {@link https://help.shopify.com/api/embedded-apps/shop-origin | Getting and storing the shop origin}.\n * @public\n */\n\nfunction createApp(config) {\n  var currentWindow = redirect_1.getWindow();\n\n  if (!currentWindow) {\n    return shared_1.serverAppBridge;\n  }\n\n  return createAppWrapper(currentWindow.top)(config);\n}\n\nexports.createApp = createApp;\n\nfunction createDispatcher(transport, config) {\n  return function (type, payload) {\n    transport.dispatch({\n      payload: payload,\n      source: config,\n      type: type\n    });\n  };\n}\n/**\n * {@inheritdocs createApp}\n * @public\n */\n\n\nexports.default = createApp;","map":{"version":3,"sources":["/home/alex/Documents/Work/ccfe/frontend/node_modules/@shopify/app-bridge/client/Client.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__importDefault","mod","__esModule","defineProperty","exports","value","helper_1","require","Error_1","Print_1","MessageTransport_1","collection_1","shared_1","env_1","print_1","redirect_1","types_1","Hooks_1","WINDOW_UNDEFINED_MESSAGE","redirectHandler","hostFrame","config","apiKey","shopOrigin","_a","forceRedirect","isDevelopmentClient","location","getLocation","isFrameless","shouldRedirect","url","pathname","search","redirect","appSetUp","app","subscribe","ActionType","APP","handleAppPrint","getUrlParams","params","hashes","slice","indexOf","split","reduce","acc","hash","_b","key","val","decodeURIComponent","getShopOrigin","shop","createClientApp","transport","middlewares","getStateListeners","listeners","actionListeners","invokeCallbacks","type","payload","hasCallback","_i","listener","id","callback","matchId","errorType","findMatchInEnum","throwError","handler","event","action","data","resolvers","splice","forEach","resolver","payload_1","fromAction","AppActionType","INVALID_CONFIG","protocol","test","message","replace","dispatcher","createDispatcher","MessageType","Unsubscribe","dispatch","Dispatch","hooks","default","localOrigin","run","LifecycleHook","DispatchAction","featuresAvailable","features","getState","then","state","keys","feature","includes","query","Promise","resolve","push","GetState","Array","isArray","undefined","addAndRemoveFromCollection","actionCallback","Subscribe","error","_this","unsubscribeCb","forEachInEnum","eventNameSpace","unsubscribe","middlewares_1","middleware","createAppWrapper","frame","WINDOW_UNDEFINED","origin","MISSING_LOCAL_ORIGIN","fromWindow","appCreator","createApp","currentWindow","getWindow","serverAppBridge","top","source"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar helper_1 = require(\"../actions/helper\");\nvar Error_1 = require(\"../actions/Error\");\nvar Print_1 = require(\"../actions/Print\");\nvar MessageTransport_1 = require(\"../MessageTransport\");\nvar collection_1 = require(\"../util/collection\");\nvar shared_1 = require(\"../util/shared\");\nvar env_1 = require(\"../util/env\");\nvar print_1 = require(\"./print\");\nvar redirect_1 = require(\"./redirect\");\nvar types_1 = require(\"./types\");\nvar Hooks_1 = __importDefault(require(\"./Hooks\"));\nexports.WINDOW_UNDEFINED_MESSAGE = 'window is not defined. Running an app outside a browser is not supported';\nfunction redirectHandler(hostFrame, config) {\n    var apiKey = config.apiKey, shopOrigin = config.shopOrigin, _a = config.forceRedirect, forceRedirect = _a === void 0 ? !env_1.isDevelopmentClient : _a;\n    var location = redirect_1.getLocation();\n    if (env_1.isFrameless ||\n        !location ||\n        !apiKey ||\n        !shopOrigin ||\n        !forceRedirect ||\n        !redirect_1.shouldRedirect(hostFrame)) {\n        return;\n    }\n    var url = \"https://\" + shopOrigin + \"/admin/apps/\" + apiKey + location.pathname + (location.search ||\n        '');\n    redirect_1.redirect(url);\n}\nfunction appSetUp(app) {\n    app.subscribe(Print_1.ActionType.APP, print_1.handleAppPrint);\n}\n/**\n * Extracts the query parameters from the current URL.\n * @deprecated This function has been deprecated.\n * @public\n */\nfunction getUrlParams() {\n    var params = {};\n    var location = redirect_1.getLocation();\n    if (!location) {\n        return params;\n    }\n    var hashes = location.search.slice(location.search.indexOf('?') + 1).split('&');\n    return hashes.reduce(function (acc, hash) {\n        var _a;\n        var _b = hash.split('='), key = _b[0], val = _b[1];\n        return __assign({}, acc, (_a = {}, _a[decodeURIComponent(key)] = decodeURIComponent(val), _a));\n    }, params);\n}\nexports.getUrlParams = getUrlParams;\n/**\n * Extracts the `shop` query parameter from the current URL.\n * @deprecated This function has been deprecated, see {@link https://help.shopify.com/api/embedded-apps/shop-origin}\n * @public\n */\nfunction getShopOrigin() {\n    var params = getUrlParams();\n    return params.shop;\n}\nexports.getShopOrigin = getShopOrigin;\n/**\n * @internal\n */\nexports.createClientApp = function (transport, middlewares) {\n    if (middlewares === void 0) { middlewares = []; }\n    var getStateListeners = [];\n    var listeners = [];\n    var actionListeners = {};\n    var invokeCallbacks = function (type, payload) {\n        var hasCallback = false;\n        if (actionListeners.hasOwnProperty(type)) {\n            for (var _i = 0, _a = actionListeners[type]; _i < _a.length; _i++) {\n                var listener = _a[_i];\n                var id = listener.id, callback = listener.callback;\n                var matchId = payload && payload.id === id;\n                if (matchId || !id) {\n                    callback(payload);\n                    hasCallback = true;\n                }\n            }\n        }\n        if (hasCallback) {\n            return;\n        }\n        // Throw an error if there are no subscriptions to this error\n        var errorType = helper_1.findMatchInEnum(Error_1.ActionType, type);\n        if (errorType) {\n            Error_1.throwError(errorType, payload);\n        }\n    };\n    var handler = function (event) {\n        var action = event.data;\n        switch (action.type) {\n            case 'getState':\n                var resolvers = getStateListeners.splice(0);\n                resolvers.forEach(function (resolver) { return resolver(action.payload); });\n                break;\n            case 'dispatch':\n                var payload_1 = action.payload;\n                invokeCallbacks(payload_1.type, payload_1.payload);\n                listeners.forEach(function (listener) { return listener.callback(payload_1); });\n                break;\n            default:\n            // Silently swallow unknown actions\n        }\n    };\n    transport.subscribe(handler);\n    return function (config) {\n        if (!config.shopOrigin) {\n            throw Error_1.fromAction('shopOrigin must be provided', Error_1.AppActionType.INVALID_CONFIG);\n        }\n        var protocol = /^https?:\\/\\//;\n        if (protocol.test(config.shopOrigin)) {\n            var message = \"shopOrigin should not include protocol, please use: \" + config.shopOrigin.replace(protocol, '');\n            throw Error_1.fromAction(message, Error_1.AppActionType.INVALID_CONFIG);\n        }\n        if (!config.apiKey) {\n            throw Error_1.fromAction('apiKey must be provided', Error_1.AppActionType.INVALID_CONFIG);\n        }\n        var dispatcher = createDispatcher(transport, config);\n        // It is possible to initialize an app multiple times\n        // Therefore we need to clear subscriptions to be safe\n        dispatcher(types_1.MessageType.Unsubscribe);\n        function dispatch(action) {\n            dispatcher(types_1.MessageType.Dispatch, action);\n            return action;\n        }\n        redirectHandler(transport.hostFrame, config);\n        var hooks = new Hooks_1.default();\n        var app = {\n            localOrigin: transport.localOrigin,\n            hooks: hooks,\n            dispatch: function (action) {\n                if (!app.hooks) {\n                    return dispatch(action);\n                }\n                return app.hooks.run(types_1.LifecycleHook.DispatchAction, dispatch, app, action);\n            },\n            featuresAvailable: function (features) {\n                return app.getState('features').then(function (state) {\n                    if (features) {\n                        Object.keys(state).forEach(function (feature) {\n                            if (!features.includes(feature)) {\n                                delete state[feature];\n                            }\n                        });\n                    }\n                    return state;\n                });\n            },\n            getState: function (query) {\n                return new Promise(function (resolve) {\n                    getStateListeners.push(resolve);\n                    dispatcher(types_1.MessageType.GetState);\n                }).then(function (state) {\n                    if (query) {\n                        return query.split('.').reduce(function (value, key) {\n                            if (typeof state !== 'object' || Array.isArray(state)) {\n                                return undefined;\n                            }\n                            value = state[key];\n                            state = value;\n                            return value;\n                        }, undefined);\n                    }\n                    return state;\n                });\n            },\n            subscribe: function () {\n                if (arguments.length < 2) {\n                    return collection_1.addAndRemoveFromCollection(listeners, { callback: arguments[0] });\n                }\n                var type = arguments[0];\n                var callback = arguments[1];\n                var id = arguments[2];\n                var actionCallback = { callback: callback, id: id };\n                var payload = { type: type, id: id };\n                if (!actionListeners.hasOwnProperty(type)) {\n                    actionListeners[type] = [];\n                }\n                dispatcher(types_1.MessageType.Subscribe, payload);\n                return collection_1.addAndRemoveFromCollection(actionListeners[type], actionCallback, function () {\n                    return dispatcher(types_1.MessageType.Unsubscribe, payload);\n                });\n            },\n            error: function (listener, id) {\n                var _this = this;\n                var unsubscribeCb = [];\n                helper_1.forEachInEnum(Error_1.ActionType, function (eventNameSpace) {\n                    // tslint:disable-next-line:no-invalid-this\n                    unsubscribeCb.push(_this.subscribe(eventNameSpace, listener, id));\n                });\n                return function () {\n                    unsubscribeCb.forEach(function (unsubscribe) { return unsubscribe(); });\n                };\n            },\n        };\n        for (var _i = 0, middlewares_1 = middlewares; _i < middlewares_1.length; _i++) {\n            var middleware = middlewares_1[_i];\n            middleware(hooks, app);\n        }\n        appSetUp(app);\n        return app;\n    };\n};\n/**\n * @public\n */\nfunction createAppWrapper(frame, localOrigin, middleware) {\n    if (middleware === void 0) { middleware = []; }\n    if (!frame) {\n        throw Error_1.fromAction(exports.WINDOW_UNDEFINED_MESSAGE, Error_1.AppActionType.WINDOW_UNDEFINED);\n    }\n    var location = redirect_1.getLocation();\n    var origin = localOrigin || (location && location.origin);\n    if (!origin) {\n        throw Error_1.fromAction('local origin cannot be blank', Error_1.AppActionType.MISSING_LOCAL_ORIGIN);\n    }\n    var transport = MessageTransport_1.fromWindow(frame, origin);\n    var appCreator = exports.createClientApp(transport, middleware);\n    return appCreator;\n}\nexports.createAppWrapper = createAppWrapper;\n/**\n * Creates your application instance.\n * @param config - Both `apiKey` and `shopOrigin` are required.\n * @remarks\n * You will need to store `shopOrigin` during the authentication process and then retrieve it for the code to work properly. To learn more about this process, see {@link https://help.shopify.com/api/embedded-apps/shop-origin | Getting and storing the shop origin}.\n * @public\n */\nfunction createApp(config) {\n    var currentWindow = redirect_1.getWindow();\n    if (!currentWindow) {\n        return shared_1.serverAppBridge;\n    }\n    return createAppWrapper(currentWindow.top)(config);\n}\nexports.createApp = createApp;\nfunction createDispatcher(transport, config) {\n    return function (type, payload) {\n        transport.dispatch({\n            payload: payload,\n            source: config,\n            type: type,\n        });\n    };\n}\n/**\n * {@inheritdocs createApp}\n * @public\n */\nexports.default = createApp;\n"]},"metadata":{},"sourceType":"script"}