{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar Error_1 = require(\"./actions/Error\");\n\nvar validator_1 = require(\"./actions/validator\");\n\nvar collection_1 = require(\"./util/collection\");\n\nvar env_1 = require(\"./util/env\");\n\nvar Context;\n\n(function (Context) {\n  Context[\"Modal\"] = \"Modal\";\n  Context[\"Main\"] = \"Main\";\n})(Context = exports.Context || (exports.Context = {}));\n/**\n * Create a MessageTransport from an IFrame.\n * @remarks\n * Used on the host-side to create a postMessage MessageTransport.\n * @beta\n */\n\n\nfunction fromFrame(frame, localOrigin, context) {\n  var handlers = [];\n\n  if (typeof frame === 'undefined' || !frame.ownerDocument || !frame.ownerDocument.defaultView) {\n    throw Error_1.fromAction('App frame is undefined', Error_1.AppActionType.WINDOW_UNDEFINED);\n  }\n\n  var parent = frame.ownerDocument.defaultView;\n  parent.addEventListener('message', function (event) {\n    if (event.origin !== localOrigin || !validator_1.isAppMessage(event)) {\n      return;\n    }\n\n    for (var _i = 0, handlers_1 = handlers; _i < handlers_1.length; _i++) {\n      var handler = handlers_1[_i];\n      handler(event);\n    }\n  });\n  return {\n    context: context,\n    localOrigin: localOrigin,\n    frameWindow: frame.contentWindow,\n    hostFrame: parent,\n    dispatch: function (message) {\n      var contentWindow = frame.contentWindow;\n\n      if (contentWindow) {\n        contentWindow.postMessage(message, localOrigin);\n      }\n    },\n    subscribe: function (handler) {\n      return collection_1.addAndRemoveFromCollection(handlers, handler);\n    }\n  };\n}\n\nexports.fromFrame = fromFrame;\n/**\n * Create a MessageTransport from a parent window.\n * @remarks\n * Used on the client-side to create a postMessage MessageTransport.\n * @internalremarks\n * In frameless mode, message should be dispatched via SmartWebView.handleMessage instead of postMessage.\n * @beta\n */\n\nfunction fromWindow(contentWindow, localOrigin) {\n  var handlers = [];\n\n  if (typeof window !== undefined) {\n    window.addEventListener('message', function (event) {\n      if (window === contentWindow && !env_1.isFrameless || event.source !== contentWindow || !(validator_1.isAppBridgeAction(event.data.payload) || validator_1.isAppMessage(event))) {\n        return;\n      }\n\n      for (var _i = 0, handlers_2 = handlers; _i < handlers_2.length; _i++) {\n        var handler = handlers_2[_i];\n        handler(event);\n      }\n    });\n  }\n\n  return {\n    localOrigin: localOrigin,\n    hostFrame: contentWindow,\n    dispatch: function (message) {\n      if (!message.source || !message.source.shopOrigin) {\n        return;\n      }\n\n      if (env_1.isFrameless && window && window.SmartWebView) {\n        window.SmartWebView.handleMessage('frameless://fromClient', JSON.stringify(message));\n        return;\n      }\n\n      var messageOrigin = \"https://\" + message.source.shopOrigin;\n      contentWindow.postMessage(message, messageOrigin);\n    },\n    subscribe: function (handler) {\n      return collection_1.addAndRemoveFromCollection(handlers, handler);\n    }\n  };\n}\n\nexports.fromWindow = fromWindow;","map":{"version":3,"sources":["/home/alex/Documents/Work/ccfe/frontend/node_modules/@shopify/app-bridge/MessageTransport.js"],"names":["Object","defineProperty","exports","value","Error_1","require","validator_1","collection_1","env_1","Context","fromFrame","frame","localOrigin","context","handlers","ownerDocument","defaultView","fromAction","AppActionType","WINDOW_UNDEFINED","parent","addEventListener","event","origin","isAppMessage","_i","handlers_1","length","handler","frameWindow","contentWindow","hostFrame","dispatch","message","postMessage","subscribe","addAndRemoveFromCollection","fromWindow","window","undefined","isFrameless","source","isAppBridgeAction","data","payload","handlers_2","shopOrigin","SmartWebView","handleMessage","JSON","stringify","messageOrigin"],"mappings":"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","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Error_1 = require(\"./actions/Error\");\nvar validator_1 = require(\"./actions/validator\");\nvar collection_1 = require(\"./util/collection\");\nvar env_1 = require(\"./util/env\");\nvar Context;\n(function (Context) {\n    Context[\"Modal\"] = \"Modal\";\n    Context[\"Main\"] = \"Main\";\n})(Context = exports.Context || (exports.Context = {}));\n/**\n * Create a MessageTransport from an IFrame.\n * @remarks\n * Used on the host-side to create a postMessage MessageTransport.\n * @beta\n */\nfunction fromFrame(frame, localOrigin, context) {\n    var handlers = [];\n    if (typeof frame === 'undefined' || !frame.ownerDocument || !frame.ownerDocument.defaultView) {\n        throw Error_1.fromAction('App frame is undefined', Error_1.AppActionType.WINDOW_UNDEFINED);\n    }\n    var parent = frame.ownerDocument.defaultView;\n    parent.addEventListener('message', function (event) {\n        if (event.origin !== localOrigin || !validator_1.isAppMessage(event)) {\n            return;\n        }\n        for (var _i = 0, handlers_1 = handlers; _i < handlers_1.length; _i++) {\n            var handler = handlers_1[_i];\n            handler(event);\n        }\n    });\n    return {\n        context: context,\n        localOrigin: localOrigin,\n        frameWindow: frame.contentWindow,\n        hostFrame: parent,\n        dispatch: function (message) {\n            var contentWindow = frame.contentWindow;\n            if (contentWindow) {\n                contentWindow.postMessage(message, localOrigin);\n            }\n        },\n        subscribe: function (handler) {\n            return collection_1.addAndRemoveFromCollection(handlers, handler);\n        },\n    };\n}\nexports.fromFrame = fromFrame;\n/**\n * Create a MessageTransport from a parent window.\n * @remarks\n * Used on the client-side to create a postMessage MessageTransport.\n * @internalremarks\n * In frameless mode, message should be dispatched via SmartWebView.handleMessage instead of postMessage.\n * @beta\n */\nfunction fromWindow(contentWindow, localOrigin) {\n    var handlers = [];\n    if (typeof window !== undefined) {\n        window.addEventListener('message', function (event) {\n            if ((window === contentWindow && !env_1.isFrameless) ||\n                event.source !== contentWindow ||\n                !(validator_1.isAppBridgeAction(event.data.payload) || validator_1.isAppMessage(event))) {\n                return;\n            }\n            for (var _i = 0, handlers_2 = handlers; _i < handlers_2.length; _i++) {\n                var handler = handlers_2[_i];\n                handler(event);\n            }\n        });\n    }\n    return {\n        localOrigin: localOrigin,\n        hostFrame: contentWindow,\n        dispatch: function (message) {\n            if (!message.source || !message.source.shopOrigin) {\n                return;\n            }\n            if (env_1.isFrameless && window && window.SmartWebView) {\n                window.SmartWebView.handleMessage('frameless://fromClient', JSON.stringify(message));\n                return;\n            }\n            var messageOrigin = \"https://\" + message.source.shopOrigin;\n            contentWindow.postMessage(message, messageOrigin);\n        },\n        subscribe: function (handler) {\n            return collection_1.addAndRemoveFromCollection(handlers, handler);\n        },\n    };\n}\nexports.fromWindow = fromWindow;\n"]},"metadata":{},"sourceType":"script"}