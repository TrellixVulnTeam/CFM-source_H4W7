{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar Error_1 = require(\"../actions/Error\");\n\nvar types_1 = require(\"../client/types\");\n\nvar collection_1 = require(\"../util/collection\");\n\nvar constants_1 = require(\"./constants\");\n\nvar merge_1 = __importDefault(require(\"./merge\"));\n\nvar types_2 = require(\"./types\");\n\nvar constants_2 = require(\"./constants\");\n\nvar uuid_1 = __importDefault(require(\"./uuid\"));\n\nvar packageJson = require('../package.json');\n\nfunction actionWrapper(action) {\n  return __assign({}, action, {\n    version: getVersion(),\n    clientInterface: {\n      name: packageJson.name,\n      version: getVersion()\n    }\n  });\n}\n\nexports.actionWrapper = actionWrapper;\n\nfunction getVersion() {\n  return packageJson.version;\n}\n\nexports.getVersion = getVersion;\n/**\n * Returns full event name with prefix, group, subgroups and type formatted with separators\n * @internal\n * */\n\nfunction getEventNameSpace(group, eventName, component) {\n  var eventNameSpace = groupToEventNameSpace(group);\n\n  if (component) {\n    var subgroups_1 = component.subgroups,\n        type = component.type;\n\n    if (subgroups_1 && subgroups_1.length > 0) {\n      eventNameSpace += eventNameSpace.length > 0 ? constants_2.SEPARATOR : '';\n      subgroups_1.forEach(function (subgroup, index) {\n        eventNameSpace += \"\" + subgroup.toUpperCase() + (index < subgroups_1.length - 1 ? constants_2.SEPARATOR : '');\n      });\n    }\n\n    if (type !== group && type) {\n      eventNameSpace += \"\" + (eventNameSpace.length > 0 ? constants_2.SEPARATOR : '') + type.toUpperCase();\n    }\n  }\n\n  if (eventNameSpace) {\n    eventNameSpace += \"\" + (eventNameSpace.length > 0 ? constants_2.SEPARATOR : '') + eventName.toUpperCase();\n  }\n\n  return \"\" + constants_1.PREFIX + constants_2.SEPARATOR + eventNameSpace;\n}\n\nexports.getEventNameSpace = getEventNameSpace;\n\nfunction isValidOptionalNumber(value) {\n  return value === null || value === undefined || typeof value === 'number';\n}\n\nexports.isValidOptionalNumber = isValidOptionalNumber;\n\nfunction isValidOptionalString(value) {\n  return value === null || value === undefined || typeof value === 'string';\n}\n\nexports.isValidOptionalString = isValidOptionalString;\n\nvar ActionSet =\n/** @class */\nfunction () {\n  function ActionSet(app, type, group, id) {\n    var _this = this;\n\n    this.app = app;\n    this.type = type;\n    this.group = group;\n    this.subgroups = [];\n    this.subscriptions = [];\n\n    if (!app) {\n      Error_1.throwError(Error_1.ActionType.INVALID_OPTIONS, 'Missing required `app`');\n    }\n\n    this.id = id || uuid_1.default();\n    this.defaultGroup = group;\n    var defaultSet = this.set;\n\n    this.set = function () {\n      var args = [];\n\n      for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n      }\n\n      var _a;\n\n      if (!_this.app.hooks) {\n        return defaultSet.apply(_this, args);\n      }\n\n      return (_a = _this.app.hooks).run.apply(_a, [types_1.LifecycleHook.UpdateAction, defaultSet, _this].concat(args));\n    };\n  }\n\n  ActionSet.prototype.set = function () {\n    var _ = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      _[_i] = arguments[_i];\n    }\n  };\n\n  Object.defineProperty(ActionSet.prototype, \"component\", {\n    get: function () {\n      return {\n        id: this.id,\n        subgroups: this.subgroups,\n        type: this.type\n      };\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  ActionSet.prototype.updateSubscription = function (subscriptionToRemove, group, subgroups) {\n    var eventType = subscriptionToRemove.eventType,\n        callback = subscriptionToRemove.callback,\n        component = subscriptionToRemove.component;\n    var currentIndex;\n    currentIndex = this.subscriptions.findIndex(function (subscription) {\n      return subscription === subscriptionToRemove;\n    });\n\n    if (currentIndex >= 0) {\n      this.subscriptions[currentIndex].unsubscribe();\n    } else {\n      currentIndex = undefined;\n    }\n\n    this.group = group;\n    this.subgroups = subgroups;\n    Object.assign(component, {\n      subgroups: this.subgroups\n    });\n    return this.subscribe(eventType, callback, component, currentIndex);\n  };\n\n  ActionSet.prototype.error = function (callback) {\n    var _this = this;\n\n    var subscriptionIndices = [];\n    forEachInEnum(Error_1.Action, function (eventNameSpace) {\n      // Keep track of subscription index so we can call unsubscribe later\n      // This ensure it will continue to work even when the subscription has been updated\n      subscriptionIndices.push(_this.subscriptions.length);\n\n      _this.subscribe(eventNameSpace, callback);\n    });\n    return function () {\n      var subscriptionsToRemove = subscriptionIndices.map(function (index) {\n        return _this.subscriptions[index];\n      });\n      subscriptionsToRemove.forEach(function (toRemove) {\n        collection_1.removeFromCollection(_this.subscriptions, toRemove, function (removed) {\n          removed.unsubscribe();\n        });\n      });\n    };\n  };\n\n  ActionSet.prototype.subscribe = function (eventName, callback, component, currentIndex) {\n    var _this = this;\n\n    var eventComponent = component || this.component;\n    var eventType = eventName.toUpperCase();\n    var boundedCallback = typeof currentIndex === 'number' ? callback : callback.bind(this);\n    var eventNameSpace;\n\n    if (Error_1.isErrorEventName(eventName)) {\n      eventNameSpace = getEventNameSpace(types_2.Group.Error, eventName, __assign({}, eventComponent, {\n        type: ''\n      }));\n    } else {\n      eventNameSpace = getEventNameSpace(this.group, eventName, eventComponent);\n    }\n\n    var unsubscribe = this.app.subscribe(eventNameSpace, boundedCallback, component ? component.id : this.id);\n    var subscription = {\n      eventType: eventType,\n      unsubscribe: unsubscribe,\n      callback: boundedCallback,\n      component: eventComponent,\n      updateSubscribe: function (group, subgroups) {\n        return _this.updateSubscription.call(_this, subscription, group, subgroups);\n      }\n    };\n\n    if (typeof currentIndex === 'number' && currentIndex >= 0 && currentIndex < this.subscriptions.length) {\n      this.subscriptions[currentIndex] = subscription;\n    } else {\n      this.subscriptions.push(subscription);\n    }\n\n    return unsubscribe;\n  };\n\n  ActionSet.prototype.unsubscribe = function (resetOnly) {\n    if (resetOnly === void 0) {\n      resetOnly = false;\n    }\n\n    unsubscribeActions(this.subscriptions, this.defaultGroup, resetOnly);\n    return this;\n  };\n\n  return ActionSet;\n}();\n\nexports.ActionSet = ActionSet;\n\nvar ActionSetWithChildren =\n/** @class */\nfunction (_super) {\n  __extends(ActionSetWithChildren, _super);\n\n  function ActionSetWithChildren() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.children = [];\n    return _this;\n  }\n\n  ActionSetWithChildren.prototype.unsubscribe = function (unsubscribeChildren, resetParentOnly) {\n    if (unsubscribeChildren === void 0) {\n      unsubscribeChildren = true;\n    }\n\n    if (resetParentOnly === void 0) {\n      resetParentOnly = false;\n    }\n\n    unsubscribeActions(this.subscriptions, this.defaultGroup, resetParentOnly);\n    this.children.forEach(function (child) {\n      if (ActionSetWithChildren.prototype.isPrototypeOf(child)) {\n        child.unsubscribe(unsubscribeChildren, unsubscribeChildren ? false : true);\n      } else {\n        child.unsubscribe(unsubscribeChildren ? false : true);\n      }\n    });\n    return this;\n  };\n\n  ActionSetWithChildren.prototype.getChild = function (id) {\n    var childIndex = this.children.findIndex(function (child) {\n      return child.id === id;\n    });\n    return childIndex >= 0 ? this.children[childIndex] : undefined;\n  };\n\n  ActionSetWithChildren.prototype.getChildIndex = function (id) {\n    return this.children.findIndex(function (child) {\n      return child.id === id;\n    });\n  };\n\n  ActionSetWithChildren.prototype.getChildSubscriptions = function (id, eventType) {\n    return this.subscriptions.filter(function (sub) {\n      return sub.component.id === id && (!eventType || eventType === sub.eventType);\n    });\n  };\n\n  ActionSetWithChildren.prototype.addChild = function (child, group, subgroups) {\n    var _this = this;\n\n    var subscriptions = child.subscriptions;\n    var existingChild = this.getChild(child.id); // Add child if it doesn't already exist\n\n    if (!existingChild) {\n      this.children.push(child);\n    }\n\n    if (!subscriptions || group === child.group && subgroups === child.subgroups) {\n      return this;\n    }\n\n    subscriptions.forEach(function (subscription) {\n      var updateSubscribe = subscription.updateSubscribe;\n      updateSubscribe(group, subgroups);\n    }); // Update child's group and subgroups\n\n    Object.assign(child, {\n      group: group,\n      subgroups: subgroups\n    }); // Update child's children subscriptions\n\n    if (ActionSetWithChildren.prototype.isPrototypeOf(child)) {\n      child.children.forEach(function (c) {\n        return _this.addChild(c, group, subgroups);\n      });\n    }\n\n    return this;\n  };\n\n  ActionSetWithChildren.prototype.removeChild = function (id) {\n    var _this = this;\n\n    collection_1.removeFromCollection(this.children, this.getChild(id), function () {\n      var toBeRemoved = _this.subscriptions.filter(function (subs) {\n        return subs.component.id === id;\n      });\n\n      toBeRemoved.forEach(function (toRemove) {\n        collection_1.removeFromCollection(_this.subscriptions, toRemove, function (removed) {\n          removed.unsubscribe();\n        });\n      });\n    });\n    return this;\n  };\n\n  ActionSetWithChildren.prototype.subscribeToChild = function (child, eventName, callback) {\n    var _this = this;\n\n    var boundedCallback = callback.bind(this);\n\n    if (eventName instanceof Array) {\n      eventName.forEach(function (e) {\n        return _this.subscribeToChild(child, e, callback);\n      });\n      return this;\n    }\n\n    if (typeof eventName !== 'string') {\n      return this;\n    }\n\n    var eventType = eventName.toUpperCase();\n    var currentSubscriptions = this.getChildSubscriptions(child.id, eventType);\n\n    if (currentSubscriptions.length > 0) {\n      // Subscription is already there, simply update it\n      currentSubscriptions.forEach(function (subs) {\n        return subs.updateSubscribe(_this.group, child.subgroups);\n      });\n    } else {\n      var childComponent = {\n        id: child.id,\n        subgroups: child.subgroups,\n        type: child.type\n      };\n      this.subscribe(eventType, boundedCallback, childComponent);\n    }\n\n    return this;\n  };\n\n  ActionSetWithChildren.prototype.getUpdatedChildActions = function (newActions, currentActions) {\n    if (newActions.length === 0) {\n      while (currentActions.length > 0) {\n        var action = currentActions.pop();\n\n        if (!action) {\n          break;\n        }\n\n        this.removeChild(action.id);\n      }\n\n      return undefined;\n    } // Only allow unique actions\n\n\n    var uniqueActions = newActions.filter(function (action, index, actionsArr) {\n      return index === actionsArr.indexOf(action);\n    });\n    var newActionIds = uniqueActions.map(function (action) {\n      return action.id;\n    }); // Remove unused actions\n\n    var unusedActions = currentActions.filter(function (action) {\n      return newActionIds.indexOf(action.id) < 0;\n    });\n\n    while (unusedActions.length > 0) {\n      var action = unusedActions.pop();\n\n      if (!action) {\n        break;\n      }\n\n      this.removeChild(action.id);\n    }\n\n    return uniqueActions;\n  };\n\n  return ActionSetWithChildren;\n}(ActionSet);\n\nexports.ActionSetWithChildren = ActionSetWithChildren;\n\nfunction unsubscribeActions(subscriptions, defaultGroup, reassign) {\n  if (reassign === void 0) {\n    reassign = false;\n  }\n\n  subscriptions.forEach(function (subscription) {\n    if (reassign) {\n      var updateSubscribe = subscription.updateSubscribe; // TODO: Support cases where we don't wipe out group and subgroups to defaults\n\n      updateSubscribe(defaultGroup, []);\n    } else {\n      var unsubscribe = subscription.unsubscribe;\n      unsubscribe();\n    }\n  });\n\n  if (!reassign) {\n    subscriptions.length = 0;\n  }\n}\n\nfunction updateActionFromPayload(action, newProps) {\n  var id = action.id;\n\n  if (id === newProps.id) {\n    // Merge new properties\n    Object.assign(action, getMergedProps(action, newProps));\n    return true;\n  }\n\n  return false;\n}\n\nexports.updateActionFromPayload = updateActionFromPayload;\n\nfunction getMergedProps(props, newProps) {\n  var merged = merge_1.default(props, newProps);\n\n  if (!merged) {\n    // tslint:disable-next-line:prefer-object-spread\n    var cloned = Object.assign(props, newProps);\n    return cloned;\n  }\n\n  return merged;\n}\n\nexports.getMergedProps = getMergedProps;\n\nfunction forEachInEnum(types, callback) {\n  Object.keys(types).forEach(function (key) {\n    callback(types[key]);\n  });\n}\n\nexports.forEachInEnum = forEachInEnum;\n\nfunction findMatchInEnum(types, lookup) {\n  var match = Object.keys(types).find(function (key) {\n    return lookup === types[key];\n  });\n  return match ? types[match] : undefined;\n}\n\nexports.findMatchInEnum = findMatchInEnum;\n\nfunction camelCaseToSnakeCase(value) {\n  return value.replace(/([A-Z])/g, function (matcher, _val, index) {\n    return \"\" + (index !== 0 ? '_' : '') + matcher[0].toLowerCase();\n  });\n}\n/**\n * Maps the group name to its event name\n * @internal\n * @remarks - This method is necessary for the new pattern of using snake case\n * which makes it more readable and easier to reconstruct the group from an event name.\n * Example: `ContextualSaveBar` becomes `CONTEXTUAL_SAVE_BAR`\n * */\n\n\nfunction groupToEventNameSpace(group) {\n  switch (group) {\n    case types_2.Group.ContextualSaveBar:\n      return camelCaseToSnakeCase(group).toUpperCase();\n\n    default:\n      return group.toUpperCase();\n  }\n}","map":{"version":3,"sources":["/home/alex/Documents/Work/ccfe/frontend/node_modules/@shopify/app-bridge/actions/helper.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__assign","assign","t","s","i","n","arguments","length","call","apply","__importDefault","mod","__esModule","defineProperty","exports","value","Error_1","require","types_1","collection_1","constants_1","merge_1","types_2","constants_2","uuid_1","packageJson","actionWrapper","action","version","getVersion","clientInterface","name","getEventNameSpace","group","eventName","component","eventNameSpace","groupToEventNameSpace","subgroups_1","subgroups","type","SEPARATOR","forEach","subgroup","index","toUpperCase","PREFIX","isValidOptionalNumber","undefined","isValidOptionalString","ActionSet","app","id","_this","subscriptions","throwError","ActionType","INVALID_OPTIONS","default","defaultGroup","defaultSet","set","args","_i","_a","hooks","run","LifecycleHook","UpdateAction","concat","_","get","enumerable","configurable","updateSubscription","subscriptionToRemove","eventType","callback","currentIndex","findIndex","subscription","unsubscribe","subscribe","error","subscriptionIndices","forEachInEnum","Action","push","subscriptionsToRemove","map","toRemove","removeFromCollection","removed","eventComponent","boundedCallback","bind","isErrorEventName","Group","Error","updateSubscribe","resetOnly","unsubscribeActions","ActionSetWithChildren","_super","children","unsubscribeChildren","resetParentOnly","child","isPrototypeOf","getChild","childIndex","getChildIndex","getChildSubscriptions","filter","sub","addChild","existingChild","c","removeChild","toBeRemoved","subs","subscribeToChild","e","currentSubscriptions","childComponent","getUpdatedChildActions","newActions","currentActions","pop","uniqueActions","actionsArr","indexOf","newActionIds","unusedActions","reassign","updateActionFromPayload","newProps","getMergedProps","props","merged","cloned","types","keys","key","findMatchInEnum","lookup","match","find","camelCaseToSnakeCase","replace","matcher","_val","toLowerCase","ContextualSaveBar"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Error_1 = require(\"../actions/Error\");\nvar types_1 = require(\"../client/types\");\nvar collection_1 = require(\"../util/collection\");\nvar constants_1 = require(\"./constants\");\nvar merge_1 = __importDefault(require(\"./merge\"));\nvar types_2 = require(\"./types\");\nvar constants_2 = require(\"./constants\");\nvar uuid_1 = __importDefault(require(\"./uuid\"));\nvar packageJson = require('../package.json');\nfunction actionWrapper(action) {\n    return __assign({}, action, { version: getVersion(), clientInterface: {\n            name: packageJson.name,\n            version: getVersion(),\n        } });\n}\nexports.actionWrapper = actionWrapper;\nfunction getVersion() {\n    return packageJson.version;\n}\nexports.getVersion = getVersion;\n/**\n * Returns full event name with prefix, group, subgroups and type formatted with separators\n * @internal\n * */\nfunction getEventNameSpace(group, eventName, component) {\n    var eventNameSpace = groupToEventNameSpace(group);\n    if (component) {\n        var subgroups_1 = component.subgroups, type = component.type;\n        if (subgroups_1 && subgroups_1.length > 0) {\n            eventNameSpace += eventNameSpace.length > 0 ? constants_2.SEPARATOR : '';\n            subgroups_1.forEach(function (subgroup, index) {\n                eventNameSpace += \"\" + subgroup.toUpperCase() + (index < subgroups_1.length - 1 ? constants_2.SEPARATOR : '');\n            });\n        }\n        if (type !== group && type) {\n            eventNameSpace += \"\" + (eventNameSpace.length > 0 ? constants_2.SEPARATOR : '') + type.toUpperCase();\n        }\n    }\n    if (eventNameSpace) {\n        eventNameSpace += \"\" + (eventNameSpace.length > 0 ? constants_2.SEPARATOR : '') + eventName.toUpperCase();\n    }\n    return \"\" + constants_1.PREFIX + constants_2.SEPARATOR + eventNameSpace;\n}\nexports.getEventNameSpace = getEventNameSpace;\nfunction isValidOptionalNumber(value) {\n    return value === null || value === undefined || typeof value === 'number';\n}\nexports.isValidOptionalNumber = isValidOptionalNumber;\nfunction isValidOptionalString(value) {\n    return value === null || value === undefined || typeof value === 'string';\n}\nexports.isValidOptionalString = isValidOptionalString;\nvar ActionSet = /** @class */ (function () {\n    function ActionSet(app, type, group, id) {\n        var _this = this;\n        this.app = app;\n        this.type = type;\n        this.group = group;\n        this.subgroups = [];\n        this.subscriptions = [];\n        if (!app) {\n            Error_1.throwError(Error_1.ActionType.INVALID_OPTIONS, 'Missing required `app`');\n        }\n        this.id = id || uuid_1.default();\n        this.defaultGroup = group;\n        var defaultSet = this.set;\n        this.set = function () {\n            var args = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                args[_i] = arguments[_i];\n            }\n            var _a;\n            if (!_this.app.hooks) {\n                return defaultSet.apply(_this, args);\n            }\n            return (_a = _this.app.hooks).run.apply(_a, [types_1.LifecycleHook.UpdateAction, defaultSet, _this].concat(args));\n        };\n    }\n    ActionSet.prototype.set = function () {\n        var _ = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            _[_i] = arguments[_i];\n        }\n    };\n    Object.defineProperty(ActionSet.prototype, \"component\", {\n        get: function () {\n            return {\n                id: this.id,\n                subgroups: this.subgroups,\n                type: this.type,\n            };\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ActionSet.prototype.updateSubscription = function (subscriptionToRemove, group, subgroups) {\n        var eventType = subscriptionToRemove.eventType, callback = subscriptionToRemove.callback, component = subscriptionToRemove.component;\n        var currentIndex;\n        currentIndex = this.subscriptions.findIndex(function (subscription) { return subscription === subscriptionToRemove; });\n        if (currentIndex >= 0) {\n            this.subscriptions[currentIndex].unsubscribe();\n        }\n        else {\n            currentIndex = undefined;\n        }\n        this.group = group;\n        this.subgroups = subgroups;\n        Object.assign(component, { subgroups: this.subgroups });\n        return this.subscribe(eventType, callback, component, currentIndex);\n    };\n    ActionSet.prototype.error = function (callback) {\n        var _this = this;\n        var subscriptionIndices = [];\n        forEachInEnum(Error_1.Action, function (eventNameSpace) {\n            // Keep track of subscription index so we can call unsubscribe later\n            // This ensure it will continue to work even when the subscription has been updated\n            subscriptionIndices.push(_this.subscriptions.length);\n            _this.subscribe(eventNameSpace, callback);\n        });\n        return function () {\n            var subscriptionsToRemove = subscriptionIndices.map(function (index) { return _this.subscriptions[index]; });\n            subscriptionsToRemove.forEach(function (toRemove) {\n                collection_1.removeFromCollection(_this.subscriptions, toRemove, function (removed) {\n                    removed.unsubscribe();\n                });\n            });\n        };\n    };\n    ActionSet.prototype.subscribe = function (eventName, callback, component, currentIndex) {\n        var _this = this;\n        var eventComponent = component || this.component;\n        var eventType = eventName.toUpperCase();\n        var boundedCallback = typeof currentIndex === 'number' ? callback : callback.bind(this);\n        var eventNameSpace;\n        if (Error_1.isErrorEventName(eventName)) {\n            eventNameSpace = getEventNameSpace(types_2.Group.Error, eventName, __assign({}, eventComponent, { type: '' }));\n        }\n        else {\n            eventNameSpace = getEventNameSpace(this.group, eventName, eventComponent);\n        }\n        var unsubscribe = this.app.subscribe(eventNameSpace, boundedCallback, component ? component.id : this.id);\n        var subscription = {\n            eventType: eventType,\n            unsubscribe: unsubscribe,\n            callback: boundedCallback,\n            component: eventComponent,\n            updateSubscribe: function (group, subgroups) {\n                return _this.updateSubscription.call(_this, subscription, group, subgroups);\n            },\n        };\n        if (typeof currentIndex === 'number' &&\n            currentIndex >= 0 &&\n            currentIndex < this.subscriptions.length) {\n            this.subscriptions[currentIndex] = subscription;\n        }\n        else {\n            this.subscriptions.push(subscription);\n        }\n        return unsubscribe;\n    };\n    ActionSet.prototype.unsubscribe = function (resetOnly) {\n        if (resetOnly === void 0) { resetOnly = false; }\n        unsubscribeActions(this.subscriptions, this.defaultGroup, resetOnly);\n        return this;\n    };\n    return ActionSet;\n}());\nexports.ActionSet = ActionSet;\nvar ActionSetWithChildren = /** @class */ (function (_super) {\n    __extends(ActionSetWithChildren, _super);\n    function ActionSetWithChildren() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.children = [];\n        return _this;\n    }\n    ActionSetWithChildren.prototype.unsubscribe = function (unsubscribeChildren, resetParentOnly) {\n        if (unsubscribeChildren === void 0) { unsubscribeChildren = true; }\n        if (resetParentOnly === void 0) { resetParentOnly = false; }\n        unsubscribeActions(this.subscriptions, this.defaultGroup, resetParentOnly);\n        this.children.forEach(function (child) {\n            if (ActionSetWithChildren.prototype.isPrototypeOf(child)) {\n                child.unsubscribe(unsubscribeChildren, unsubscribeChildren ? false : true);\n            }\n            else {\n                child.unsubscribe(unsubscribeChildren ? false : true);\n            }\n        });\n        return this;\n    };\n    ActionSetWithChildren.prototype.getChild = function (id) {\n        var childIndex = this.children.findIndex(function (child) { return child.id === id; });\n        return childIndex >= 0 ? this.children[childIndex] : undefined;\n    };\n    ActionSetWithChildren.prototype.getChildIndex = function (id) {\n        return this.children.findIndex(function (child) { return child.id === id; });\n    };\n    ActionSetWithChildren.prototype.getChildSubscriptions = function (id, eventType) {\n        return this.subscriptions.filter(function (sub) { return sub.component.id === id && (!eventType || eventType === sub.eventType); });\n    };\n    ActionSetWithChildren.prototype.addChild = function (child, group, subgroups) {\n        var _this = this;\n        var subscriptions = child.subscriptions;\n        var existingChild = this.getChild(child.id);\n        // Add child if it doesn't already exist\n        if (!existingChild) {\n            this.children.push(child);\n        }\n        if (!subscriptions || (group === child.group && subgroups === child.subgroups)) {\n            return this;\n        }\n        subscriptions.forEach(function (subscription) {\n            var updateSubscribe = subscription.updateSubscribe;\n            updateSubscribe(group, subgroups);\n        });\n        // Update child's group and subgroups\n        Object.assign(child, { group: group, subgroups: subgroups });\n        // Update child's children subscriptions\n        if (ActionSetWithChildren.prototype.isPrototypeOf(child)) {\n            child.children.forEach(function (c) { return _this.addChild(c, group, subgroups); });\n        }\n        return this;\n    };\n    ActionSetWithChildren.prototype.removeChild = function (id) {\n        var _this = this;\n        collection_1.removeFromCollection(this.children, this.getChild(id), function () {\n            var toBeRemoved = _this.subscriptions.filter(function (subs) { return subs.component.id === id; });\n            toBeRemoved.forEach(function (toRemove) {\n                collection_1.removeFromCollection(_this.subscriptions, toRemove, function (removed) {\n                    removed.unsubscribe();\n                });\n            });\n        });\n        return this;\n    };\n    ActionSetWithChildren.prototype.subscribeToChild = function (child, eventName, callback) {\n        var _this = this;\n        var boundedCallback = callback.bind(this);\n        if (eventName instanceof Array) {\n            eventName.forEach(function (e) { return _this.subscribeToChild(child, e, callback); });\n            return this;\n        }\n        if (typeof eventName !== 'string') {\n            return this;\n        }\n        var eventType = eventName.toUpperCase();\n        var currentSubscriptions = this.getChildSubscriptions(child.id, eventType);\n        if (currentSubscriptions.length > 0) {\n            // Subscription is already there, simply update it\n            currentSubscriptions.forEach(function (subs) { return subs.updateSubscribe(_this.group, child.subgroups); });\n        }\n        else {\n            var childComponent = {\n                id: child.id,\n                subgroups: child.subgroups,\n                type: child.type,\n            };\n            this.subscribe(eventType, boundedCallback, childComponent);\n        }\n        return this;\n    };\n    ActionSetWithChildren.prototype.getUpdatedChildActions = function (newActions, currentActions) {\n        if (newActions.length === 0) {\n            while (currentActions.length > 0) {\n                var action = currentActions.pop();\n                if (!action) {\n                    break;\n                }\n                this.removeChild(action.id);\n            }\n            return undefined;\n        }\n        // Only allow unique actions\n        var uniqueActions = newActions.filter(function (action, index, actionsArr) { return index === actionsArr.indexOf(action); });\n        var newActionIds = uniqueActions.map(function (action) { return action.id; });\n        // Remove unused actions\n        var unusedActions = currentActions.filter(function (action) {\n            return newActionIds.indexOf(action.id) < 0;\n        });\n        while (unusedActions.length > 0) {\n            var action = unusedActions.pop();\n            if (!action) {\n                break;\n            }\n            this.removeChild(action.id);\n        }\n        return uniqueActions;\n    };\n    return ActionSetWithChildren;\n}(ActionSet));\nexports.ActionSetWithChildren = ActionSetWithChildren;\nfunction unsubscribeActions(subscriptions, defaultGroup, reassign) {\n    if (reassign === void 0) { reassign = false; }\n    subscriptions.forEach(function (subscription) {\n        if (reassign) {\n            var updateSubscribe = subscription.updateSubscribe;\n            // TODO: Support cases where we don't wipe out group and subgroups to defaults\n            updateSubscribe(defaultGroup, []);\n        }\n        else {\n            var unsubscribe = subscription.unsubscribe;\n            unsubscribe();\n        }\n    });\n    if (!reassign) {\n        subscriptions.length = 0;\n    }\n}\nfunction updateActionFromPayload(action, newProps) {\n    var id = action.id;\n    if (id === newProps.id) {\n        // Merge new properties\n        Object.assign(action, getMergedProps(action, newProps));\n        return true;\n    }\n    return false;\n}\nexports.updateActionFromPayload = updateActionFromPayload;\nfunction getMergedProps(props, newProps) {\n    var merged = merge_1.default(props, newProps);\n    if (!merged) {\n        // tslint:disable-next-line:prefer-object-spread\n        var cloned = Object.assign(props, newProps);\n        return cloned;\n    }\n    return merged;\n}\nexports.getMergedProps = getMergedProps;\nfunction forEachInEnum(types, callback) {\n    Object.keys(types).forEach(function (key) {\n        callback(types[key]);\n    });\n}\nexports.forEachInEnum = forEachInEnum;\nfunction findMatchInEnum(types, lookup) {\n    var match = Object.keys(types).find(function (key) {\n        return lookup === types[key];\n    });\n    return match ? types[match] : undefined;\n}\nexports.findMatchInEnum = findMatchInEnum;\nfunction camelCaseToSnakeCase(value) {\n    return value.replace(/([A-Z])/g, function (matcher, _val, index) {\n        return \"\" + (index !== 0 ? '_' : '') + matcher[0].toLowerCase();\n    });\n}\n/**\n * Maps the group name to its event name\n * @internal\n * @remarks - This method is necessary for the new pattern of using snake case\n * which makes it more readable and easier to reconstruct the group from an event name.\n * Example: `ContextualSaveBar` becomes `CONTEXTUAL_SAVE_BAR`\n * */\nfunction groupToEventNameSpace(group) {\n    switch (group) {\n        case types_2.Group.ContextualSaveBar:\n            return camelCaseToSnakeCase(group).toUpperCase();\n        default:\n            return group.toUpperCase();\n    }\n}\n"]},"metadata":{},"sourceType":"script"}